services:
  # --- æœå‹™ 1: SQL Server è³‡æ–™åº« ---
  db:
    image: mcr.microsoft.com/mssql/server:2022-latest
    container_name: ecommerce-db
    environment:
      - ACCEPT_EULA=Y
      - SA_PASSWORD=ChangeMe123! # âš ï¸ å¯†ç¢¼è¦å¤ è¤‡é›œï¼Œä¸ç„¶ SQL Server æœƒæ‹’çµ•å•Ÿå‹•
    user: root
    ports:
      - "1433:1433" # è®“æˆ‘å€‘å¾æœ¬æ©Ÿä¹Ÿèƒ½é€£é€²å»æª¢æŸ¥
    volumes:
      - mssql_data:/var/opt/mssql/data # è³‡æ–™æŒä¹…åŒ– (é‡å•Ÿå¾Œè³‡æ–™ä¸æœƒä¸è¦‹)

  # --- æœå‹™ 2: .NET å¾Œç«¯ API ---
  api:
    build: . # ç›´æ¥è®€å–ç•¶å‰ç›®éŒ„çš„ Dockerfile ä¾†æ‰“åŒ…
    container_name: ecommerce-api
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
      # ğŸ‘‡ é—œéµé­”æ³•åœ¨é€™è£¡ï¼
      # æˆ‘å€‘ç”¨ç’°å¢ƒè®Šæ•¸ã€Œè¦†è“‹ã€æ‰ appsettings.json è£¡çš„é€£ç·šå­—ä¸²
      # Server=dbï¼šé€™è£¡çš„ "db" å°æ‡‰åˆ°ä¸Šé¢å®šç¾©çš„æœå‹™åç¨± (service name)
      - ConnectionStrings__DefaultConnection=Server=db;Database=ECommerceDb;User Id=sa;Password=ChangeMe123!;TrustServerCertificate=True;
    ports:
      - "8080:8080"
    depends_on:
      - db # å‘Šè¨´ Dockerï¼šè¦å…ˆå•Ÿå‹•è³‡æ–™åº«ï¼Œå†å•Ÿå‹• API

volumes:
  mssql_data: